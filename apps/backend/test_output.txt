
[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90m/Users/robzlabz/Documents/projects/worktest/birthday/apps/backend[39m

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould create a user without events
[22m[39mQuery: insert into "users" ("id", "email", "first_name", "last_name", "location", "created_at") values (?, ?, ?, ?, ?, ?) returning "id", "email", "first_name", "last_name", "location", "created_at" -- params: ["019b887c-6cb3-7486-9e31-a5da3673bf49", "test@example.com", "John", "Doe", "UTC", 1767521414]

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould create a user without events
[22m[39mQuery: select "id", "email", "first_name", "last_name", "location", "created_at", (select coalesce(json_group_array(json_array("id", "user_id", "type", "event_date", "month_day", "created_at")), json_array()) as "data" from "user_events" "users_events" where "users_events"."user_id" = "users"."id") as "events" from "users" "users" where "users"."id" = ? limit ? -- params: ["019b887c-6cb3-7486-9e31-a5da3673bf49", 1]

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould create a user with events
[22m[39mQuery: insert into "users" ("id", "email", "first_name", "last_name", "location", "created_at") values (?, ?, ?, ?, ?, ?) returning "id", "email", "first_name", "last_name", "location", "created_at" -- params: ["019b887c-6cba-72a1-8f02-e6c263cc18af", "jane@example.com", "Jane", "Doe", "Asia/Jakarta", 1767521414]

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould create a user with events
[22m[39mQuery: insert into "user_events" ("id", "user_id", "type", "event_date", "month_day", "created_at") values (?, ?, ?, ?, ?, ?) -- params: ["019b887c-6cbb-7dbb-81d2-4d3371a1ef74", "019b887c-6cba-72a1-8f02-e6c263cc18af", "birthday", "1990-05-20", "05-20", 1767521414]

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould create a user with events
[22m[39mQuery: select "id", "email", "first_name", "last_name", "location", "created_at", (select coalesce(json_group_array(json_array("id", "user_id", "type", "event_date", "month_day", "created_at")), json_array()) as "data" from "user_events" "users_events" where "users_events"."user_id" = "users"."id") as "events" from "users" "users" where "users"."id" = ? limit ? -- params: ["019b887c-6cba-72a1-8f02-e6c263cc18af", 1]

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould update user and sync events
[22m[39mQuery: insert into "users" ("id", "email", "first_name", "last_name", "location", "created_at") values (?, ?, ?, ?, ?, ?) returning "id", "email", "first_name", "last_name", "location", "created_at" -- params: ["019b887c-6cbd-7c8d-8ac7-750c01358613", "update@example.com", "Original", "Name", "UTC", 1767521414]

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould update user and sync events
[22m[39mQuery: insert into "user_events" ("id", "user_id", "type", "event_date", "month_day", "created_at") values (?, ?, ?, ?, ?, ?) -- params: ["019b887c-6cbd-7c8d-8ac7-750d7ce39635", "019b887c-6cbd-7c8d-8ac7-750c01358613", "birthday", "1990-01-01", "01-01", 1767521414]

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould update user and sync events
[22m[39mQuery: update "users" set "first_name" = ? where "users"."id" = ? returning "id", "email", "first_name", "last_name", "location", "created_at" -- params: ["Updated", "019b887c-6cbd-7c8d-8ac7-750c01358613"]

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould delete a user and its events (cascade)
[22m[39mQuery: insert into "users" ("id", "email", "first_name", "last_name", "location", "created_at") values (?, ?, ?, ?, ?, ?) returning "id", "email", "first_name", "last_name", "location", "created_at" -- params: ["019b887c-6cc0-76ce-a0c9-bc65a59d5120", "delete@example.com", "Delete", "Me", "UTC", 1767521414]

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould delete a user and its events (cascade)
[22m[39mQuery: insert into "user_events" ("id", "user_id", "type", "event_date", "month_day", "created_at") values (?, ?, ?, ?, ?, ?) -- params: ["019b887c-6cc0-76ce-a0c9-bc662505c1f1", "019b887c-6cc0-76ce-a0c9-bc65a59d5120", "birthday", "1990-01-01", "01-01", 1767521414]

[90mstdout[2m | src/repositories/user.repository.test.ts[2m > [22m[2mUserRepository[2m > [22m[2mshould delete a user and its events (cascade)
[22m[39mQuery: delete from "users" where "users"."id" = ? returning "id", "email", "first_name", "last_name", "location", "created_at" -- params: ["019b887c-6cc0-76ce-a0c9-bc65a59d5120"]

 [31mâ¯[39m src/repositories/user.repository.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[32m 30[2mms[22m[39m
[31m     [31mÃ—[31m should create a user without events[39m[32m 22[2mms[22m[39m
[31m     [31mÃ—[31m should create a user with events[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should update user and sync events[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should delete a user and its events (cascade)[39m[32m 3[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 4 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m src/repositories/user.repository.test.ts[2m > [22mUserRepository[2m > [22mshould create a user without events
[31m[1mError[22m: Failed query: select "id", "email", "first_name", "last_name", "location", "created_at", (select coalesce(json_group_array(json_array("id", "user_id", "type", "event_date", "month_day", "created_at")), json_array()) as "data" from "user_events" "users_events" where "users_events"."user_id" = "users"."id") as "events" from "users" "users" where "users"."id" = ? limit ?
params: 019b887c-6cb3-7486-9e31-a5da3673bf49,1[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m43:15[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:12[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:18[22m[39m
[36m [2mâ¯[22m UserRepository.getById src/repositories/user.repository.ts:[2m19:16[22m[39m
    [90m 17| [39m
    [90m 18| [39m    [35masync[39m [34mgetById[39m(id[33m:[39m string) {
    [90m 19| [39m        [35mreturn[39m [35mawait[39m [35mthis[39m[33m.[39mdb[33m.[39mquery[33m.[39musers[33m.[39m[34mfindFirst[39m({
    [90m   | [39m               [31m^[39m
    [90m 20| [39m            where[33m:[39m [34meq[39m(users[33m.[39mid[33m,[39m id)[33m,[39m
    [90m 21| [39m            [35mwith[39m[33m:[39m {
[90m [2mâ¯[22m src/repositories/user.repository.test.ts:[2m29:25[22m[39m

[31m[1mCaused by: LibsqlError[22m: SQLITE_ERROR: no such table: users[39m
[90m [2mâ¯[22m mapSqliteError node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m392:16[22m[39m
[90m [2mâ¯[22m executeStmt node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m297:15[22m[39m
[90m [2mâ¯[22m Sqlite3Client.execute node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m81:16[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m195:61[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m41:22[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:23[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:29[22m[39m
[90m [2mâ¯[22m QueryPromise.executeRaw node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/query.js:[2m134:35[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/query.js:[2m139:17[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'SQLITE_ERROR', rawCode: 1 }[39m
[31m[1mCaused by: SqliteError[22m: no such table: users[39m
[90m [2mâ¯[22m convertError node_modules/.pnpm/libsql@0.5.22/node_modules/libsql/index.js:[2m59:12[22m[39m
[90m [2mâ¯[22m Database.prepare node_modules/.pnpm/libsql@0.5.22/node_modules/libsql/index.js:[2m131:13[22m[39m
[90m [2mâ¯[22m executeStmt node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m268:28[22m[39m
[90m [2mâ¯[22m Sqlite3Client.execute node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m81:16[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m195:61[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m41:22[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:23[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:29[22m[39m
[90m [2mâ¯[22m QueryPromise.executeRaw node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/query.js:[2m134:35[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/query.js:[2m139:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'SQLITE_ERROR', rawCode: 1 }[39m
[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/4]â¯[22m[39m

[41m[1m FAIL [22m[49m src/repositories/user.repository.test.ts[2m > [22mUserRepository[2m > [22mshould create a user with events
[31m[1mError[22m: Failed query: select "id", "email", "first_name", "last_name", "location", "created_at", (select coalesce(json_group_array(json_array("id", "user_id", "type", "event_date", "month_day", "created_at")), json_array()) as "data" from "user_events" "users_events" where "users_events"."user_id" = "users"."id") as "events" from "users" "users" where "users"."id" = ? limit ?
params: 019b887c-6cba-72a1-8f02-e6c263cc18af,1[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m43:15[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:12[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:18[22m[39m
[36m [2mâ¯[22m UserRepository.getById src/repositories/user.repository.ts:[2m19:16[22m[39m
    [90m 17| [39m
    [90m 18| [39m    [35masync[39m [34mgetById[39m(id[33m:[39m string) {
    [90m 19| [39m        [35mreturn[39m [35mawait[39m [35mthis[39m[33m.[39mdb[33m.[39mquery[33m.[39musers[33m.[39m[34mfindFirst[39m({
    [90m   | [39m               [31m^[39m
    [90m 20| [39m            where[33m:[39m [34meq[39m(users[33m.[39mid[33m,[39m id)[33m,[39m
    [90m 21| [39m            [35mwith[39m[33m:[39m {
[90m [2mâ¯[22m src/repositories/user.repository.test.ts:[2m49:25[22m[39m

[31m[1mCaused by: LibsqlError[22m: SQLITE_ERROR: no such table: users[39m
[90m [2mâ¯[22m mapSqliteError node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m392:16[22m[39m
[90m [2mâ¯[22m executeStmt node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m297:15[22m[39m
[90m [2mâ¯[22m Sqlite3Client.execute node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m81:16[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m195:61[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m41:22[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:23[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:29[22m[39m
[90m [2mâ¯[22m QueryPromise.executeRaw node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/query.js:[2m134:35[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/query.js:[2m139:17[22m[39m
[90m [2mâ¯[22m QueryPromise.then node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/query-promise.js:[2m21:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'SQLITE_ERROR', rawCode: 1 }[39m
[31m[1mCaused by: SqliteError[22m: no such table: users[39m
[90m [2mâ¯[22m convertError node_modules/.pnpm/libsql@0.5.22/node_modules/libsql/index.js:[2m59:12[22m[39m
[90m [2mâ¯[22m Database.prepare node_modules/.pnpm/libsql@0.5.22/node_modules/libsql/index.js:[2m131:13[22m[39m
[90m [2mâ¯[22m executeStmt node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m268:28[22m[39m
[90m [2mâ¯[22m Sqlite3Client.execute node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m81:16[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m195:61[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m41:22[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:23[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:29[22m[39m
[90m [2mâ¯[22m QueryPromise.executeRaw node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/query.js:[2m134:35[22m[39m
[90m [2mâ¯[22m QueryPromise.execute node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/query.js:[2m139:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'SQLITE_ERROR', rawCode: 1 }[39m
[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/4]â¯[22m[39m

[41m[1m FAIL [22m[49m src/repositories/user.repository.test.ts[2m > [22mUserRepository[2m > [22mshould update user and sync events
[31m[1mError[22m: Failed query: update "users" set "first_name" = ? where "users"."id" = ? returning "id", "email", "first_name", "last_name", "location", "created_at"
params: Updated,019b887c-6cbd-7c8d-8ac7-750c01358613[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m43:15[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:12[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:18[22m[39m
[36m [2mâ¯[22m src/repositories/user.repository.ts:[2m55:33[22m[39m
    [90m 53| [39m
    [90m 54| [39m        [35mreturn[39m [35mawait[39m [35mthis[39m[33m.[39mdb[33m.[39m[34mtransaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m 55| [39m            [35mconst[39m updatedUser [33m=[39m [35mawait[39m tx[33m.[39m[34mupdate[39m(users)
    [90m   | [39m                                [31m^[39m
    [90m 56| [39m                [33m.[39m[35mset[39m(userData)
    [90m 57| [39m                [33m.[39m[34mwhere[39m([34meq[39m(users[33m.[39mid[33m,[39m id))
[90m [2mâ¯[22m LibSQLSession.transaction node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m71:22[22m[39m
[90m [2mâ¯[22m UserRepository.update src/repositories/user.repository.ts:[2m54:16[22m[39m
[90m [2mâ¯[22m src/repositories/user.repository.test.ts:[2m68:25[22m[39m

[31m[1mCaused by: LibsqlError[22m: SQLITE_ERROR: no such table: users[39m
[90m [2mâ¯[22m mapSqliteError node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m392:16[22m[39m
[90m [2mâ¯[22m executeStmt node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m297:15[22m[39m
[90m [2mâ¯[22m Sqlite3Transaction.execute node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m205:16[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m195:33[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m41:22[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:23[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:29[22m[39m
[90m [2mâ¯[22m QueryPromise.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/update.js:[2m167:28[22m[39m
[36m [2mâ¯[22m src/repositories/user.repository.ts:[2m59:18[22m[39m
[90m [2mâ¯[22m LibSQLSession.transaction node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m71:28[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'SQLITE_ERROR', rawCode: 1 }[39m
[31m[1mCaused by: SqliteError[22m: no such table: users[39m
[90m [2mâ¯[22m convertError node_modules/.pnpm/libsql@0.5.22/node_modules/libsql/index.js:[2m59:12[22m[39m
[90m [2mâ¯[22m Database.prepare node_modules/.pnpm/libsql@0.5.22/node_modules/libsql/index.js:[2m131:13[22m[39m
[90m [2mâ¯[22m executeStmt node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m268:28[22m[39m
[90m [2mâ¯[22m Sqlite3Transaction.execute node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m205:16[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m195:33[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m41:22[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:23[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:29[22m[39m
[90m [2mâ¯[22m QueryPromise.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/update.js:[2m167:28[22m[39m
[36m [2mâ¯[22m src/repositories/user.repository.ts:[2m59:18[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'SQLITE_ERROR', rawCode: 1 }[39m
[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/4]â¯[22m[39m

[41m[1m FAIL [22m[49m src/repositories/user.repository.test.ts[2m > [22mUserRepository[2m > [22mshould delete a user and its events (cascade)
[31m[1mError[22m: Failed query: delete from "users" where "users"."id" = ? returning "id", "email", "first_name", "last_name", "location", "created_at"
params: 019b887c-6cc0-76ce-a0c9-bc65a59d5120[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m43:15[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:12[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:18[22m[39m
[36m [2mâ¯[22m UserRepository.delete src/repositories/user.repository.ts:[2m90:16[22m[39m
    [90m 88| [39m
    [90m 89| [39m    [35masync[39m [35mdelete[39m(id[33m:[39m string) {
    [90m 90| [39m        return await this.db.delete(users).where(eq(users.id, id)).retâ€¦
    [90m   | [39m               [31m^[39m
    [90m 91| [39m    }
    [90m 92| [39m}
[90m [2mâ¯[22m src/repositories/user.repository.test.ts:[2m89:9[22m[39m

[31m[1mCaused by: LibsqlError[22m: SQLITE_ERROR: no such table: users[39m
[90m [2mâ¯[22m mapSqliteError node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m392:16[22m[39m
[90m [2mâ¯[22m executeStmt node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m297:15[22m[39m
[90m [2mâ¯[22m Sqlite3Client.execute node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m81:16[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m195:61[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m41:22[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:23[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:29[22m[39m
[90m [2mâ¯[22m QueryPromise.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/delete.js:[2m108:28[22m[39m
[36m [2mâ¯[22m UserRepository.delete src/repositories/user.repository.ts:[2m90:80[22m[39m
[90m [2mâ¯[22m src/repositories/user.repository.test.ts:[2m89:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'SQLITE_ERROR', rawCode: 1 }[39m
[31m[1mCaused by: SqliteError[22m: no such table: users[39m
[90m [2mâ¯[22m convertError node_modules/.pnpm/libsql@0.5.22/node_modules/libsql/index.js:[2m59:12[22m[39m
[90m [2mâ¯[22m Database.prepare node_modules/.pnpm/libsql@0.5.22/node_modules/libsql/index.js:[2m131:13[22m[39m
[90m [2mâ¯[22m executeStmt node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m268:28[22m[39m
[90m [2mâ¯[22m Sqlite3Client.execute node_modules/.pnpm/@libsql+client@0.15.15/node_modules/@libsql/client/lib-esm/sqlite3.js:[2m81:16[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m195:61[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/session.js:[2m41:22[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.values node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m193:23[22m[39m
[90m [2mâ¯[22m LibSQLPreparedQuery.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/libsql/session.js:[2m167:29[22m[39m
[90m [2mâ¯[22m QueryPromise.get node_modules/.pnpm/drizzle-orm@0.45.1_@cloudflare+workers-types@4.20260101.0_@libsql+client@0.15.15_@types_52e584a4655194c0f037fcc60d868f82/node_modules/drizzle-orm/sqlite-core/query-builders/delete.js:[2m108:28[22m[39m
[36m [2mâ¯[22m UserRepository.delete src/repositories/user.repository.ts:[2m90:80[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'SQLITE_ERROR', rawCode: 1 }[39m
[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/4]â¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[90m (4)[39m
[2m   Start at [22m 17:10:14
[2m   Duration [22m 282ms[2m (transform 41ms, setup 0ms, import 141ms, tests 30ms, environment 0ms)[22m

